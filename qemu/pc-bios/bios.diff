? _rombios_.c
? _rombiosl_.c
? a.out
? biossums
? rombios.s
? rombios.sym
? rombios.txt
? rombios16.bin
? rombios32.bin
? rombios32.out
? rombiosl.s
? rombiosl.sym
? rombiosl.txt
Index: BIOS-bochs-latest
===================================================================
RCS file: /cvsroot/bochs/bochs/bios/BIOS-bochs-latest,v
retrieving revision 1.143
diff -u -r1.143 BIOS-bochs-latest
Binary files /tmp/cvsa097Xs and BIOS-bochs-latest differ
Index: BIOS-bochs-legacy
===================================================================
RCS file: /cvsroot/bochs/bochs/bios/BIOS-bochs-legacy,v
retrieving revision 1.7
diff -u -r1.7 BIOS-bochs-legacy
Binary files /tmp/cvs6T0CAL and BIOS-bochs-legacy differ
Index: rombios.c
===================================================================
RCS file: /cvsroot/bochs/bochs/bios/rombios.c,v
retrieving revision 1.170
diff -u -r1.170 rombios.c
--- rombios.c	30 Sep 2006 11:22:53 -0000	1.170
+++ rombios.c	14 Feb 2007 12:51:08 -0000
@@ -9468,7 +9468,7 @@
 use16 386
 rombios32_10:
   ;; restore data segment limits to 0xffff
-  mov ax, #0x28
+  mov ax, #0x30
   mov ds, ax
   mov es, ax
   mov ss, ax
@@ -9503,7 +9503,7 @@
   ret
 
 rombios32_gdt_48:
-  dw 0x30
+  dw 0x37
   dw rombios32_gdt                  
   dw 0x000f
 
@@ -9513,6 +9513,7 @@
   dw 0xffff, 0, 0x9b00, 0x00cf ; 32 bit flat code segment (0x10)
   dw 0xffff, 0, 0x9300, 0x00cf ; 32 bit flat data segment (0x18)
   dw 0xffff, 0, 0x9b0f, 0x0000 ; 16 bit code segment base=0xf0000 limit=0xffff
+  dw 0, 0, 0, 0
   dw 0xffff, 0, 0x9300, 0x0000 ; 16 bit data segment base=0x0 limit=0xffff
 #endif
 
Index: rombios.h
===================================================================
RCS file: /cvsroot/bochs/bochs/bios/rombios.h,v
retrieving revision 1.3
diff -u -r1.3 rombios.h
--- rombios.h	3 Oct 2006 20:27:30 -0000	1.3
+++ rombios.h	14 Feb 2007 12:51:08 -0000
@@ -19,7 +19,7 @@
 //  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301 USA
 
 /* define it to include QEMU specific code */
-//#define BX_QEMU
+#define BX_QEMU
 
 #ifndef LEGACY
 #  define BX_ROMBIOS32     1
Index: rombios32.c
===================================================================
RCS file: /cvsroot/bochs/bochs/bios/rombios32.c,v
retrieving revision 1.2
diff -u -r1.2 rombios32.c
--- rombios32.c	29 Sep 2006 12:23:34 -0000	1.2
+++ rombios32.c	14 Feb 2007 12:51:08 -0000
@@ -39,7 +39,7 @@
 //#define BX_USE_EBDA_TABLES
 
 /* define it if the (emulated) hardware supports SMM mode */
-#define BX_USE_SMM
+#undef BX_USE_SMM
 
 #define BX_INFO(fmt, args...) bios_printf(0, fmt, ## args);
 
@@ -843,8 +843,10 @@
     int ioapic_id, i, len;
     int mp_config_table_size;
 
+#ifdef BX_QEMU
     if (smp_cpus <= 1)
         return;
+#endif
 
 #ifdef BX_USE_EBDA_TABLES
     mp_config_table = (uint8_t *)(ram_size - ACPI_DATA_SIZE - MPTABLE_MAX_SIZE);
